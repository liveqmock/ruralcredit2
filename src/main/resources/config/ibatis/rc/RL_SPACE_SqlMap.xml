<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RL_SPACE" >
<typeAlias alias="space" type="com.creditease.rc.domain.Space"/>
  <resultMap id="abatorgenerated_SpaceResult" class="com.creditease.rc.domain.Space" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    <result column="SPACEID" property="spaceid" jdbcType="DECIMAL" />
    <result column="CITYDEPARTMENTNAME" property="citydepartmentname" jdbcType="VARCHAR" />
    <result column="CITYDEPARTMENTID" property="citydepartmentid" jdbcType="VARCHAR" />
    <result column="AREADEPARTMENTNAME" property="areadepartmentname" jdbcType="VARCHAR" />
    <result column="AREADEPARTMENTID" property="areadepartmentid" jdbcType="VARCHAR" />
    <result column="REGIONNAME" property="regionname" jdbcType="VARCHAR" />
    <result column="REGIONID" property="regionid" jdbcType="VARCHAR" />
    <result column="SPACEDATE" property="spacedate" jdbcType="TIMESTAMP" />
    <result column="SPACETIME" property="spacetime" jdbcType="TIMESTAMP" />
    <result column="SPACEPLACE" property="spaceplace" jdbcType="VARCHAR" />
    <result column="PERSONPLANNING" property="personplanning" jdbcType="VARCHAR" />
    <result column="PERSONID" property="personid" jdbcType="VARCHAR" />
    <result column="CUSTOMERCONSULTCOUNT" property="customerconsultcount" jdbcType="VARCHAR" />
    <result column="SPACESTUDIT" property="spacestudit" jdbcType="CHAR" />
    <result column="SPACEDATE_REALITY" property="spacedateReality" jdbcType="TIMESTAMP" />
    <result column="SPACETIME_REALITY" property="spacetimeReality" jdbcType="TIMESTAMP" />
    <result column="SPACEPLACE_REALITY" property="spaceplaceReality" jdbcType="VARCHAR" />
    <result column="PARTICIPANTS_REALITY" property="participantsReality" jdbcType="VARCHAR" />
    <result column="PARTICIPANTSID_REALITY" property="participantsidReality" jdbcType="VARCHAR" />
    <result column="CUSTOMERCONSULTCOUNT_REALITY" property="customerconsultcountReality" jdbcType="VARCHAR" />
    <result column="PHOTOCOUNT" property="photocount" jdbcType="VARCHAR" />
  </resultMap>
  <!-- 延期更改状态 -->
  <update id="updateSpaceStud" parameterClass="string">
  	update rl_space t set t.spacestudit='2' where t.spaceid=#spaceid#
  </update>
  
  <!-- 展业计划列表查询 -->
  <sql id="spaceList">
  	select t.spaceid spaceid,
      t.regionname regionname,
       t.citydepartmentname citydepartmentname,
       t.areadepartmentname areadepartmentname,
       t.spacedate spacedate,
       t.spacetime spacetime,
       t.spaceplace spaceplace,
       t.personplanning personplanning,
       t.customerconsultcount customerconsultcount,
       t.spacestudit spacestudit,
      (select c.code_value from  rl_codetable c 
      where c.code_key=(CASE WHEN trunc(sysdate)>trunc(t.spacedate) and (t.spacedate_reality is  null) THEN '2' 
                         ELSE t.spacestudit END) and c.section='spacestudit') sapceText,
       t.spacedate_reality spacedateReality,
       t.spacetime_reality spacetimeReality,
       t.spaceplace_reality spaceplaceReality,
       t.participants_reality participantsReality,
       t.customerconsultcount_reality customerconsultcountReality,
       t.photocount photocount 
       from rl_space t 
       <dynamic prepend="where">
       		<isNotEmpty prepend="AND"  property="space.areadepartmentid">
       			(t.regionid in ($space.areadepartmentid$)  or t.citydepartmentid in ($space.areadepartmentid$) or t.areadepartmentid in ($space.areadepartmentid$))
       		</isNotEmpty>
       		<isNotEmpty prepend="AND"  property="space.spacedate_begin">
       			t.spacedate >= #space.spacedate_begin#
       		</isNotEmpty>
       		<isNotEmpty prepend="AND"  property="space.spacedate_end">
       			 #space.spacedate_end# >= t.spacedate
       		</isNotEmpty>
       		<isNotEmpty prepend="AND"  property="space.spacestudit">
       			t.spacestudit = #space.spacestudit#
       		</isNotEmpty>
       </dynamic>
  </sql>
  <select id="selectSpaceList" parameterClass="java.util.Map" resultClass="space">
  		<include refid="spaceList"/>
  </select>
  
  <select id="selectSpaceListCount" parameterClass="java.util.Map" resultClass="int">
  		select count(*) from (<include refid="spaceList"/>)
  </select>
  
  <!-- 导出Excel start -->
  <sql id="downloadExcel">
  		select t.spaceid spaceid,
      t.regionname regionname,
       t.citydepartmentname citydepartmentname,
       t.areadepartmentname areadepartmentname,
       t.spacedate spacedate,
       TO_CHAR(t.spacetime,'YYYY-MM-DD HH24:MI:SS') spacetime,
       t.spaceplace spaceplace,
       t.personplanning personplanning,
       t.customerconsultcount customerconsultcount,
       t.spacestudit spacestudit,
      (select c.code_value from  rl_codetable c 
      where c.code_key=(CASE WHEN trunc(sysdate)>trunc(t.spacedate) and (t.spacedate_reality is  null) THEN '2' 
                          ELSE t.spacestudit END) and c.section='spacestudit') sapceText,
       t.spacedate_reality spacedateReality,
       TO_CHAR(t.spacetime_reality,'YYYY-MM-DD HH24:MI:SS') spacetimeReality,
       t.spaceplace_reality spaceplaceReality,
       t.participants_reality participantsReality,
       t.customerconsultcount_reality customerconsultcountReality,
       t.photocount photocount 
       from rl_space t where ((CASE WHEN trunc(sysdate)>trunc(t.spacedate) and (t.spacedate_reality is  null) THEN '2' 
                          ELSE t.spacestudit END)='0') or 
       ((CASE WHEN trunc(sysdate)>trunc(t.spacedate) and (t.spacedate_reality is  null) THEN '2' 
                         ELSE t.spacestudit END)='1')
       <dynamic prepend="and">
       		<isNotEmpty prepend="AND"  property="space.areadepartmentid">
       			(t.regionid in ($space.areadepartmentid$)  or t.citydepartmentid in ($space.areadepartmentid$) or t.areadepartmentid in ($space.areadepartmentid$))
       		</isNotEmpty>
       		<isNotEmpty prepend="AND"  property="space.spacedate_begin">
       			t.spacedate >= #space.spacedate_begin#
       		</isNotEmpty>
       		<isNotEmpty prepend="AND"  property="space.spacedate_end">
       			 #space.spacedate_end# >= t.spacedate
       		</isNotEmpty>
       		<isNotEmpty prepend="AND"  property="space.spacestudit">
       			t.spacestudit = #space.spacestudit#
       		</isNotEmpty>
       </dynamic>
  </sql>
  
  <select id="downloadExcelList" parameterClass="java.util.Map" resultClass="java.util.HashMap">
  		<include refid="downloadExcel"/>
  </select>
  <select id="downloadExcelListCount" parameterClass="java.util.Map" resultClass="int">
  		select count(*) from (<include refid="downloadExcel"/>)
  </select>
  <!-- 导出Excel end -->
  
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_SpaceResult" parameterClass="com.creditease.rc.domain.Space" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    select SPACEID, CITYDEPARTMENTNAME, CITYDEPARTMENTID, AREADEPARTMENTNAME, AREADEPARTMENTID,
      REGIONNAME, REGIONID, SPACEDATE, SPACETIME, SPACEPLACE, PERSONPLANNING, PERSONID,
      CUSTOMERCONSULTCOUNT, SPACESTUDIT, SPACEDATE_REALITY, SPACETIME_REALITY, SPACEPLACE_REALITY,
      PARTICIPANTS_REALITY, PARTICIPANTSID_REALITY, CUSTOMERCONSULTCOUNT_REALITY, PHOTOCOUNT
    from RL_SPACE
    where SPACEID = #spaceid:DECIMAL#
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.creditease.rc.domain.Space" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    delete from RL_SPACE
    where SPACEID = #spaceid:DECIMAL#
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="com.creditease.rc.domain.Space" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    <selectKey resultClass="java.lang.Long" keyProperty="spaceid" >
      select SEQ_BASIC_INFO.NEXTVAL  from dual
    </selectKey>
    insert into RL_SPACE (SPACEID,CITYDEPARTMENTNAME, CITYDEPARTMENTID, AREADEPARTMENTNAME,
      AREADEPARTMENTID, REGIONNAME, REGIONID, SPACEDATE, SPACETIME, SPACEPLACE, PERSONPLANNING,
      PERSONID, CUSTOMERCONSULTCOUNT, SPACESTUDIT, SPACEDATE_REALITY, SPACETIME_REALITY,
      SPACEPLACE_REALITY, PARTICIPANTS_REALITY, PARTICIPANTSID_REALITY,
      CUSTOMERCONSULTCOUNT_REALITY, PHOTOCOUNT)
    values (#spaceid:DECIMAL#,#citydepartmentname:VARCHAR#, #citydepartmentid:VARCHAR#, #areadepartmentname:VARCHAR#,
      #areadepartmentid:VARCHAR#, #regionname:VARCHAR#, #regionid:VARCHAR#, #spacedate:TIMESTAMP#,
      #spacetime:TIMESTAMP#, #spaceplace:VARCHAR#, #personplanning:VARCHAR#, #personid:VARCHAR#,
      #customerconsultcount:VARCHAR#, #spacestudit:CHAR#, #spacedateReality:TIMESTAMP#,
      #spacetimeReality:TIMESTAMP#, #spaceplaceReality:VARCHAR#, #participantsReality:VARCHAR#,
      #participantsidReality:VARCHAR#, #customerconsultcountReality:VARCHAR#, #photocount:VARCHAR#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="com.creditease.rc.domain.Space" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_SPACE
    set CITYDEPARTMENTNAME = #citydepartmentname:VARCHAR#,
      CITYDEPARTMENTID = #citydepartmentid:VARCHAR#,
      AREADEPARTMENTNAME = #areadepartmentname:VARCHAR#,
      AREADEPARTMENTID = #areadepartmentid:VARCHAR#,
      REGIONNAME = #regionname:VARCHAR#,
      REGIONID = #regionid:VARCHAR#,
      SPACEDATE = #spacedate:TIMESTAMP#,
      SPACETIME = #spacetime:TIMESTAMP#,
      SPACEPLACE = #spaceplace:VARCHAR#,
      PERSONPLANNING = #personplanning:VARCHAR#,
      PERSONID = #personid:VARCHAR#,
      CUSTOMERCONSULTCOUNT = #customerconsultcount:VARCHAR#,
      SPACESTUDIT = #spacestudit:CHAR#,
      SPACEDATE_REALITY = #spacedateReality:TIMESTAMP#,
      SPACETIME_REALITY = #spacetimeReality:TIMESTAMP#,
      SPACEPLACE_REALITY = #spaceplaceReality:VARCHAR#,
      PARTICIPANTS_REALITY = #participantsReality:VARCHAR#,
      PARTICIPANTSID_REALITY = #participantsidReality:VARCHAR#,
      CUSTOMERCONSULTCOUNT_REALITY = #customerconsultcountReality:VARCHAR#,
      PHOTOCOUNT = #photocount:VARCHAR#
    where SPACEID = #spaceid:DECIMAL#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.creditease.rc.domain.Space" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_SPACE set SPACESTUDIT='1'
    <dynamic prepend="," >
      <isNotNull prepend="," property="citydepartmentname" >
        CITYDEPARTMENTNAME = #citydepartmentname:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="citydepartmentid" >
        CITYDEPARTMENTID = #citydepartmentid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="areadepartmentname" >
        AREADEPARTMENTNAME = #areadepartmentname:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="areadepartmentid" >
        AREADEPARTMENTID = #areadepartmentid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="regionname" >
        REGIONNAME = #regionname:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="regionid" >
        REGIONID = #regionid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="spacedate" >
        SPACEDATE = #spacedate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="spacetime" >
        SPACETIME = #spacetime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="spaceplace" >
        SPACEPLACE = #spaceplace:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="personplanning" >
        PERSONPLANNING = #personplanning:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="personid" >
        PERSONID = #personid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerconsultcount" >
        CUSTOMERCONSULTCOUNT = #customerconsultcount:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="spacestudit" >
        SPACESTUDIT = #spacestudit:CHAR#
      </isNotNull>
      <isNotNull prepend="," property="spacedateReality" >
        SPACEDATE_REALITY = #spacedateReality:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="spacetimeReality" >
        SPACETIME_REALITY = #spacetimeReality:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="spaceplaceReality" >
        SPACEPLACE_REALITY = #spaceplaceReality:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="participantsReality" >
        PARTICIPANTS_REALITY = #participantsReality:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="participantsidReality" >
        PARTICIPANTSID_REALITY = #participantsidReality:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerconsultcountReality" >
        CUSTOMERCONSULTCOUNT_REALITY = #customerconsultcountReality:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="photocount" >
        PHOTOCOUNT = #photocount:VARCHAR#
      </isNotNull>
    </dynamic>
    where SPACEID = #spaceid:DECIMAL#
  </update>
</sqlMap>