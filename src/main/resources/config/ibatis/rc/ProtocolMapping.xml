<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RL_PROTOCOL_MAPPING" >
  <typeAlias alias="protocolMapping" type="com.creditease.rc.domain.ProtocolMapping"/>
  <typeAlias alias="protocolVO" type="com.creditease.rc.vo.ProtocolVO"/>
  <resultMap id="abatorgenerated_ProtocolMappingResult" class="com.creditease.rc.domain.ProtocolMapping" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    <result column="MAPPING_ID" property="mappingId" jdbcType="DECIMAL" />
    <result column="CREDITAPPLICATION_ID" property="creditapplicationId" jdbcType="DECIMAL" />
    <result column="PROTOCOL_NUMBER" property="protocolNumber" jdbcType="VARCHAR" />
    <result column="BRANCHOFFICE_NAME" property="branchofficeName" jdbcType="VARCHAR" />
    <result column="BRANCHOFFICE_ID" property="branchofficeId" jdbcType="VARCHAR" />
    <result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
    <result column="OPERATE_DATE" property="operateDate" jdbcType="TIMESTAMP" />
    <result column="DOWN_LOAD_URL" property="downLoadUrl" jdbcType="VARCHAR" />
  </resultMap>
  
  <delete id="deleteIcp" parameterClass="string">
  delete from RL_PROTOCOL_MAPPING
    where MAPPING_ID = #creditapplicationId#
  </delete>
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_ProtocolMappingResult" parameterClass="protocolMapping" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    select MAPPING_ID, CREDITAPPLICATION_ID, PROTOCOL_NUMBER, BRANCHOFFICE_NAME, BRANCHOFFICE_ID,OPERATOR,OPERATE_DATE,DOWN_LOAD_URL
    from RL_PROTOCOL_MAPPING
    where MAPPING_ID = #mappingId:DECIMAL#
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="protocolMapping" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    delete from RL_PROTOCOL_MAPPING
    where MAPPING_ID = #mappingId:DECIMAL#
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="protocolMapping" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    <selectKey keyProperty="mappingId" resultClass="java.lang.Long" type="pre">
			select SEQ_BASIC_INFO.NEXTVAL as value from dual
	</selectKey>
    insert into RL_PROTOCOL_MAPPING (MAPPING_ID, CREDITAPPLICATION_ID, PROTOCOL_NUMBER,
      BRANCHOFFICE_NAME, BRANCHOFFICE_ID,OPERATOR,OPERATE_DATE,DOWN_LOAD_URL)
    values (#mappingId:DECIMAL#, #creditapplicationId:DECIMAL#, #protocolNumber:VARCHAR#,
      #branchofficeName:VARCHAR#, #branchofficeId:VARCHAR#, #operator:VARCHAR#, #operateDate:TIMESTAMP#,#downLoadUrl:VARCHAR#)
  </insert>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="protocolMapping" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_PROTOCOL_MAPPING
    set CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#,
      PROTOCOL_NUMBER = #protocolNumber:VARCHAR#,
      BRANCHOFFICE_NAME = #branchofficeName:VARCHAR#,
      BRANCHOFFICE_ID = #branchofficeId:VARCHAR#
      OPERATOR = #operator:VARCHAR#,
      OPERATE_DATE = #operateDate:TIMESTAMP#,
      DOWN_LOAD_URL=#downLoadUrl:VARCHAR#
    where MAPPING_ID = #mappingId:DECIMAL#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="protocolMapping" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_PROTOCOL_MAPPING
    <dynamic prepend="set" >
      <isNotEmpty prepend="," property="creditapplicationId" >
        CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="," property="protocolNumber" >
        PROTOCOL_NUMBER = #protocolNumber:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="branchofficeName" >
        BRANCHOFFICE_NAME = #branchofficeName:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="branchofficeId" >
        BRANCHOFFICE_ID = #branchofficeId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="operator" >
        OPERATOR = #operator:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="operateDate" >
        OPERATE_DATE = #operateDate:TIMESTAMP#
      </isNotEmpty>
      <isNotEmpty prepend="," property="downLoadUrl" >
        DOWN_LOAD_URL=#downLoadUrl:VARCHAR#
      </isNotEmpty>
    </dynamic>
    where MAPPING_ID = #mappingId:DECIMAL#
  </update>
  <!-- 分页查询sql片段 -->
  <sql id="selectProtocolMappingByPagination_sql">
  		select c.business_number,
  				b.name,
  				mapping.MAPPING_ID,
  				mapping.CREDITAPPLICATION_ID,
  				mapping.PROTOCOL_NUMBER,
  				mapping.BRANCHOFFICE_NAME,
  				mapping.BRANCHOFFICE_ID,
  				mapping.OPERATOR,
  				mapping.DOWN_LOAD_URL,
  				to_char(mapping.OPERATE_DATE,'yyyy-mm-dd hh24:mi:ss') OPERATE_DATE,
                c.repayment_plan_name
  		 from RL_PROTOCOL_MAPPING mapping ,RL_CREDIT_APPLICATION c left join rl_borrower_service_app b
	        on b.creditapplication_id = c.creditapplication_id
	        and b.valid_state = '1'
	        and b.leader = '1'
  		where 1=1
  		  and c.creditapplication_id=mapping.creditapplication_id
  	 <dynamic prepend="AND">
	  	 <isNotEmpty prepend="AND" property="branchofficeName" >
			           mapping.BRANCHOFFICE_NAME like '%$branchofficeName$%'
		 </isNotEmpty>
		 <isNotEmpty prepend="AND" property="branchofficeId" >
                      c.company_id in ($branchofficeId$)
		 </isNotEmpty>
	  	 <isNotEmpty prepend="AND" property="protocolNumber" >
			           mapping.PROTOCOL_NUMBER like '%$protocolNumber$%'
		 </isNotEmpty>
	  	 <isNotEmpty prepend="AND" property="businessNumber" >
			           c.business_number like '%$businessNumber$%'
		 </isNotEmpty>
         <isNotEmpty prepend="AND" property="productTypeName" >
			           c.repayment_plan_name = #productTypeName#
		 </isNotEmpty>
	 </dynamic>
  </sql>
  <!-- 分页查询合同映射表 -->
  <select id="selectProtocolMappingByPagination" parameterClass="protocolVO" resultClass="java.util.HashMap">
  	 <include refid="selectProtocolMappingByPagination_sql"/>  
        order by mapping.BRANCHOFFICE_NAME,c.business_number,mapping.PROTOCOL_NUMBER
  </select>
  <!-- 分页数查询 -->
  <select id="selectCountByPagination" parameterClass="protocolVO" resultClass="int">
	      select count(*) from
	      (
		    <include refid="selectProtocolMappingByPagination_sql"/>     
		  )    
  </select>
  <!-- 查询ProtocolMappingList -->
  <select id="selectProtocolMappingListSelective" parameterClass="protocolMapping" resultMap="abatorgenerated_ProtocolMappingResult">
    select * from RL_PROTOCOL_MAPPING
	   <dynamic prepend="where" >
	      <isNotEmpty prepend="and" property="mappingId" >
	        MAPPING_ID = #mappingId:DECIMAL#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="creditapplicationId" >
	        CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="protocolNumber" >
	        PROTOCOL_NUMBER = #protocolNumber:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="branchofficeName" >
	        BRANCHOFFICE_NAME = #branchofficeName:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="branchofficeId" >
	        BRANCHOFFICE_ID = #branchofficeId:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="operator" >
	        OPERATOR = #operator:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="operateDate" >
	        OPERATE_DATE = #operateDate:TIMESTAMP#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="downLoadUrl" >
	        DOWN_LOAD_URL=#downLoadUrl:VARCHAR#
	      </isNotEmpty>
	    </dynamic>
  </select>
  <!-- 查询合同编号  luohongjie -->
  <select id="selectProtocolNumber" resultClass="protocolMapping"  parameterClass="java.lang.Long">
		select 
		ma.mapping_id mappingId,
		ma.creditapplication_id creditapplicationId,
		ma.protocol_number protocolNumber,
		ma.branchoffice_name branchofficeName,
		ma.branchoffice_id branchofficeId,
		ma.operator operator,
		ma.operate_date operateDate,
		ma.down_load_url downLoadUrl from rl_protocol_mapping ma 
		where ma.creditapplication_id=
		#creditapplicationId:DECIMAL#
	</select>
</sqlMap>