<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RL_PROTOCOL_PREFIX_MAPPING">
	<typeAlias alias="protocolPrefixMapping" type="com.creditease.rc.domain.ProtocolPrefixMapping" />
	<resultMap id="abatorgenerated_ProtocolPrefixMappingResult" class="com.creditease.rc.domain.ProtocolPrefixMapping">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		<result column="PREFIX_ID" property="prefixId" jdbcType="DECIMAL" />
		<result column="BRANCHOFFICE_NAME" property="branchofficeName" jdbcType="VARCHAR" />
		<result column="PREFIX_NUMBER" property="prefixNumber" jdbcType="VARCHAR" />
		<result column="BRANCHOFFICE_ID" property="branchofficeId" jdbcType="VARCHAR" />
		<result column="OPERATOR" property="operator" jdbcType="VARCHAR" />
		<result column="OPERATE_DATE" property="operateDate" jdbcType="TIMESTAMP" />
		<result column="ON_OFF" property="onOff" jdbcType="VARCHAR" />
		<result column="PROVINCEHOME" property="provinceHome" jdbcType="VARCHAR" />
		<result column="CITYHOME" property="cityHome" jdbcType="VARCHAR" />
		<result column="COUNTYHOME" property="countyHome" jdbcType="VARCHAR" />

	</resultMap>
	
	<!-- 根据分公司id查询合同前缀 -->
	<select id="quPrefixNumber" parameterClass="string" resultClass="string">
		select t.prefix_number from RL_PROTOCOL_PREFIX_MAPPING t where t.branchoffice_id=#branchofficeId#
	</select>
	
	<select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_ProtocolPrefixMappingResult" parameterClass="protocolPrefixMapping">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		select PREFIX_ID, BRANCHOFFICE_NAME, PREFIX_NUMBER, BRANCHOFFICE_ID, OPERATOR, OPERATE_DATE,
		ON_OFF,(select replace(to_char(wm_concat(na.city_name)), ',', '-')
		from rl_national_standard_code na where na.city_code = prefix.provincehome
		or na.city_code = prefix.cityhome or na.city_code = prefix.countyhome) as addRess
		from RL_PROTOCOL_PREFIX_MAPPING
		where PREFIX_ID = #prefixId:DECIMAL#
	</select>
	<delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="protocolPrefixMapping">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		delete from RL_PROTOCOL_PREFIX_MAPPING
		where PREFIX_ID = #prefixId:DECIMAL#
	</delete>
	<insert id="abatorgenerated_insert" parameterClass="protocolPrefixMapping">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		<selectKey keyProperty="prefixId" resultClass="java.lang.Long" type="pre">
			select SEQ_BASIC_INFO.NEXTVAL as value from dual
	</selectKey>
		insert into RL_PROTOCOL_PREFIX_MAPPING (PREFIX_ID, BRANCHOFFICE_NAME, PREFIX_NUMBER,
		BRANCHOFFICE_ID, OPERATOR, OPERATE_DATE, ON_OFF,PROVINCEHOME,CITYHOME,COUNTYHOME)
		values (#prefixId:DECIMAL#, #branchofficeName:VARCHAR#, #prefixNumber:VARCHAR#,
		#branchofficeId:VARCHAR#, #operator:VARCHAR#, #operateDate:TIMESTAMP#, #onOff:VARCHAR#,
		#provinceHome:VARCHAR#,#cityHome:VARCHAR#,#countyHome:VARCHAR#)
	</insert>
	<update id="abatorgenerated_updateByPrimaryKey" parameterClass="protocolPrefixMapping">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		update RL_PROTOCOL_PREFIX_MAPPING
		set BRANCHOFFICE_NAME = #branchofficeName:VARCHAR#,
		PREFIX_NUMBER = #prefixNumber:VARCHAR#,
		BRANCHOFFICE_ID = #branchofficeId:VARCHAR#,
		OPERATOR = #operator:VARCHAR#,
		OPERATE_DATE = #operateDate:TIMESTAMP#,
		ON_OFF = #onOff:VARCHAR#,
		PROVINCEHOME=#provinceHome:VARCHAR#,
		CITYHOME=#cityHome:VARCHAR#,
		COUNTYHOME=#countyHome:VARCHAR#
		where PREFIX_ID = #prefixId:DECIMAL#
	</update>
	<update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="protocolPrefixMapping">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		update RL_PROTOCOL_PREFIX_MAPPING
		<dynamic prepend="set">
			<isNotEmpty prepend="," property="branchofficeName">
				BRANCHOFFICE_NAME = #branchofficeName:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="prefixNumber">
				PREFIX_NUMBER = #prefixNumber:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="branchofficeId">
				BRANCHOFFICE_ID = #branchofficeId:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="operator">
				OPERATOR = #operator:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="operateDate">
				OPERATE_DATE = #operateDate:TIMESTAMP#
      </isNotEmpty>
			<isNotEmpty prepend="," property="onOff">
				ON_OFF = #onOff:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="provinceHome">
				PROVINCEHOME = #provinceHome:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="cityHome">
				CITYHOME= #cityHome:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="countyHome">
				COUNTYHOME = #countyHome:VARCHAR#
      </isNotEmpty>
		</dynamic>
		where PREFIX_ID = #prefixId:DECIMAL#
	</update>

	<!-- 分页查询sql片段 -->
	<sql id="selectProtocolPrefixMappingByPagination_sql">
		select prefix.PREFIX_ID,
		prefix.BRANCHOFFICE_NAME,
		prefix.PREFIX_NUMBER,
		prefix.BRANCHOFFICE_ID,
		prefix.OPERATOR,
		to_char(prefix.OPERATE_DATE, 'yyyy-mm-dd hh24:mi:ss') OPERATE_DATE,
		prefix.ON_OFF,
		prefix.provincehome,
		prefix.cityhome,
		prefix.countyhome,
		(select replace(to_char(wm_concat(na.city_name)), ',', '-')
		from rl_national_standard_code na where na.city_code = prefix.provincehome
		or na.city_code = prefix.cityhome or na.city_code = prefix.countyhome) as addRess
		from RL_PROTOCOL_PREFIX_MAPPING prefix
		<dynamic prepend="where">
			<isNotEmpty prepend="AND" property="branchofficeName">
				prefix.BRANCHOFFICE_NAME like '%$branchofficeName$%'
		 </isNotEmpty>
			<isNotEmpty prepend="AND" property="branchofficeId">
				prefix.BRANCHOFFICE_ID in ($branchofficeId$)
		 </isNotEmpty>
			<isNotEmpty prepend="AND" property="prefixNumber">
				prefix.PREFIX_NUMBER like '%$prefixNumber$%'
		 </isNotEmpty>
			<isNotEmpty prepend="AND" property="onOff">
				prefix.ON_OFF like '%$onOff$%'
		 </isNotEmpty>
		</dynamic>
	</sql>
	<!-- 分页查询合同映射表 -->
	<select id="selectProtocolPrefixMappingByPagination" parameterClass="protocolPrefixMapping" resultClass="java.util.HashMap">
		<include refid="selectProtocolPrefixMappingByPagination_sql" />
		order by prefix.BRANCHOFFICE_NAME,prefix.PREFIX_NUMBER
	</select>
	<!-- 分页数查询 -->
	<select id="selectCountByPagination" parameterClass="protocolPrefixMapping" resultClass="int">
		select count(*) from
		(
		<include refid="selectProtocolPrefixMappingByPagination_sql" />
		)
	</select>

	<!-- 查询前缀list -->
	<select id="selectProtocolPrefixMappingListSelective" parameterClass="protocolPrefixMapping" resultMap="abatorgenerated_ProtocolPrefixMappingResult">
		select * from RL_PROTOCOL_PREFIX_MAPPING prefix
		<dynamic prepend="where">
			<isNotEmpty prepend="AND" property="branchofficeName">
				prefix.BRANCHOFFICE_NAME like '%$branchofficeName$%'
			 </isNotEmpty>
			<isNotEmpty prepend="AND" property="branchofficeId">
				prefix.BRANCHOFFICE_ID like '%$branchofficeId$%'
			 </isNotEmpty>
			<isNotEmpty prepend="AND" property="prefixNumber">
				prefix.PREFIX_NUMBER like '%$prefixNumber$%'
			 </isNotEmpty>
			<isNotEmpty prepend="AND" property="onOff">
				prefix.ON_OFF like '%$onOff$%'
			 </isNotEmpty>
		</dynamic>

	</select>
	<!-- 分组查询营业部和区/县对应关系 -->
	<select id="queryDistrictAndDepartment" resultClass="protocolPrefixMapping">
		select ppm.countyhome as countyhome, ppm.branchoffice_id as branchofficeId
		from rl_protocol_prefix_mapping ppm
		where ppm.countyhome is not null
		and ppm.on_off = 'Y'
		group by ppm.countyhome, ppm.branchoffice_id
	</select>
</sqlMap>