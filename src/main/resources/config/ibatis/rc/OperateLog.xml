<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="rl_operate_log" >
  <typeAlias alias="operateLogVO" type="com.creditease.rc.vo.OperateLogVO"/>
  <typeAlias alias="operateLog" type="com.creditease.rc.domain.OperateLog"/>
  <resultMap id="operateLogMap" class="com.creditease.rc.domain.OperateLog" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    <result column="OPERATE_LOG_ID" property="operateLogId" jdbcType="DECIMAL" />
    <result column="CREDITAPPLICATION_ID" property="creditapplicationId" jdbcType="DECIMAL" />
    <result column="OPERATOR_ID" property="operatorId" jdbcType="DECIMAL" />
    <result column="OPERATOR_NAME" property="operatorName" jdbcType="VARCHAR" />
    <result column="OPERATE_DATE" property="operateDate" jdbcType="TIMESTAMP" />
    <result column="FUNCTION_CODE" property="functionCode" jdbcType="VARCHAR" />
    <result column="FUNCTION_BUSSINESS" property="functionBussiness" jdbcType="VARCHAR" />
  </resultMap>
  <insert id="abatorgenerated_insert" parameterClass="operateLog" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    <!-- 日志插入 -->
    <selectKey keyProperty="operateLogId" resultClass="java.lang.Long" type="pre">
			select SEQ_BASIC_INFO.NEXTVAL as value from dual
	</selectKey>
    insert into RL_OPERATE_LOG (OPERATE_LOG_ID, CREDITAPPLICATION_ID, OPERATOR_ID, OPERATOR_NAME,
      OPERATE_DATE, FUNCTION_CODE, FUNCTION_BUSSINESS)
    values (#operateLogId:DECIMAL#, #creditapplicationId:DECIMAL#, #operatorId:VARCHAR#,
      #operatorName:VARCHAR#, #operateDate:TIMESTAMP#, #functionCode:VARCHAR#,
      #functionBussiness:VARCHAR#)
  </insert>
  <!-- 分页查询sql片段 -->
  <sql id="selectOperateLogByPagination_sql" >
  	      select distinct c.creditapplication_id as creditapplication_id,
	             c.BUSINESS_NUMBER as business_number,
	             c.BORROWER_NAME as borrower_name,
	             c.LOAN_OFFICER_NAME as loan_officer_name,
	             c.COMPANY_NAME as company_name,
	             o.OPERATOR_NAME as operator_name,
	             to_char(o.OPERATE_DATE,'yyyy-mm-dd hh24:mi:ss') as operate_date,
	             DECODE(substr(nvl(o.FUNCTION_CODE,'5'),0,1),
	             '1','申请模块',
	             '2','审批模块',
	             '3','放款模块',
	             '4','收款模块',
	             '5','财务模块',
	             '6','免罚模块',
	                 '其他模块') FUNCTION_CODE,
	             code.CODE_VALUE as code_value,
	             o.FUNCTION_BUSSINESS as function_bussiness
		    from rl_operate_log o,rl_codetable code,rl_credit_application c left join  rl_borrower_service_app app 
		      on app.creditapplication_id = c.creditapplication_id
		   where 1=1
             and o.creditapplication_id = c.creditapplication_id
             and code.SECTION='operateLogType'
             and o.FUNCTION_CODE = code.CODE_KEY
           <isNotEmpty prepend="AND" property="operatorName" >
		           o.OPERATOR_NAME like '%$operatorName$%'
		   </isNotEmpty>
        	<isNotEmpty prepend="AND" property="startDate" >
		           o.OPERATE_DATE >= to_date('$startDate$ 00:00:00','yyyy-mm-dd hh24:mi:ss')
		   </isNotEmpty>
        	<isNotEmpty prepend="AND" property="endDate" >
        	<![CDATA[
		           o.OPERATE_DATE <= to_date('$endDate$ 23:59:59','yyyy-mm-dd hh24:mi:ss')
		     ]]>      
		   </isNotEmpty>
		    <isNotEmpty prepend="AND" property="functionCode" >
		           o.FUNCTION_CODE like '$functionCode$%'
		   </isNotEmpty>
		    <isNotEmpty prepend="AND" property="loanOfficerName" >
		           c.LOAN_OFFICER_NAME like '%$loanOfficerName$%'
		   </isNotEmpty>
        	<isNotEmpty prepend="AND" property="companyName" >
		           c.COMPANY_NAME like '%$companyName$%'
		   </isNotEmpty>
        	<isNotEmpty prepend="AND" property="businessNumber" >
		           c.BUSINESS_NUMBER =#businessNumber#
		   </isNotEmpty>
           <isNotEmpty prepend="AND" property="borrowerName" >
		           c.BORROWER_NAME like '%$borrowerName$%'
		   </isNotEmpty>
		   
		   <dynamic prepend="and" open="(" close=")">
			   	<isNotEmpty prepend="OR" property="fuzzyBusinessNumber" >
			           c.BUSINESS_NUMBER like '%$fuzzyBusinessNumber$%'
			   </isNotEmpty>
	           <isNotEmpty prepend="OR" property="fuzzyBorrowerName" >
			           c.BORROWER_NAME like '%$fuzzyBorrowerName$%'
			   </isNotEmpty>
	           <isNotEmpty prepend="OR" property="fuzzyLoanOfficerName" >
			           c.LOAN_OFFICER_NAME like '%$fuzzyLoanOfficerName$%'
			   </isNotEmpty>
	           <isNotEmpty prepend="OR" property="fuzzyOperatorName" >
			           o.OPERATOR_NAME like '%$fuzzyOperatorName$%'
			   </isNotEmpty>
	       </dynamic>
  </sql>
  
  <!-- 日志分页查询 -分页列表  返回map都是大写-->
   <select id="selectOperateLogByPagination" parameterClass="operateLogVO" resultClass="java.util.HashMap">
	      
         <include refid="selectOperateLogByPagination_sql"/>  
          
        order by c.BUSINESS_NUMBER,OPERATE_DATE
    </select>
    <!-- 日志分页查询-分页数 -->
    <select id="countByPage" parameterClass="operateLogVO" resultClass="int">
	      select count(*) from
	      (
		    <include refid="selectOperateLogByPagination_sql"/>     
		  )    
    </select>
    
    <select id="abatorgenerated_selectByPrimaryKey" parameterClass="operateLog" resultMap="operateLogMap">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    select OPERATE_LOG_ID, CREDITAPPLICATION_ID, OPERATOR_ID, OPERATOR_NAME, OPERATE_DATE,
      FUNCTION_CODE, FUNCTION_BUSSINESS
    from RL_OPERATE_LOG
    where OPERATE_LOG_ID = #operateLogId:DECIMAL#
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="operateLog">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    delete from RL_OPERATE_LOG
    where OPERATE_LOG_ID = #operateLogId:DECIMAL#
  </delete>
 
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="operateLog">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_OPERATE_LOG
    set CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#,
      OPERATOR_ID = #operatorId:VARCHAR#,
      OPERATOR_NAME = #operatorName:VARCHAR#,
      OPERATE_DATE = #operateDate:TIMESTAMP#,
      FUNCTION_CODE = #functionCode:VARCHAR#,
      FUNCTION_BUSSINESS = #functionBussiness:VARCHAR#
    where OPERATE_LOG_ID = #operateLogId:DECIMAL#
  </update>
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="operateLog">
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_OPERATE_LOG
    <dynamic prepend="set">
      <isNotEmpty prepend="," property="creditapplicationId">
        CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#
      </isNotEmpty>
      <isNotEmpty prepend="," property="operatorId">
        OPERATOR_ID = #operatorId:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="operatorName">
        OPERATOR_NAME = #operatorName:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="operateDate">
        OPERATE_DATE = #operateDate:TIMESTAMP#
      </isNotEmpty>
      <isNotEmpty prepend="," property="functionCode">
        FUNCTION_CODE = #functionCode:VARCHAR#
      </isNotEmpty>
      <isNotEmpty prepend="," property="functionBussiness">
        FUNCTION_BUSSINESS = #functionBussiness:VARCHAR#
      </isNotEmpty>
    </dynamic>
    where OPERATE_LOG_ID = #operateLogId:DECIMAL#
  </update>
  <!-- 日志查询by属性 -->
  <sql id="selectByOperateLog">
  	select OPERATE_LOG_ID, CREDITAPPLICATION_ID, OPERATOR_ID, OPERATOR_NAME, OPERATE_DATE,FUNCTION_CODE, FUNCTION_BUSSINESS
    from RL_OPERATE_LOG 
    <dynamic prepend="where"> 
    	  <isNotEmpty prepend="and" property="creditapplicationId">
	        CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="operatorId">
	        OPERATOR_ID = #operatorId:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="operatorName">
	        OPERATOR_NAME = #operatorName:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="operateDate">
	        OPERATE_DATE = #operateDate:TIMESTAMP#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="functionCode">
	        FUNCTION_CODE = #functionCode:VARCHAR#
	      </isNotEmpty>
	      <isNotEmpty prepend="and" property="functionBussiness">
	        FUNCTION_BUSSINESS = #functionBussiness:VARCHAR#
	      </isNotEmpty>
     </dynamic>
  </sql>
  <select id="selectByCreditId" parameterClass="operateLog" resultMap="operateLogMap">
    	<include refid="selectByOperateLog"/>  
    	order by OPERATE_DATE 
  </select>
  <select id="countByPageCreditId" parameterClass="operateLog" resultClass="int">
	      select count(*) from
	      (
		    <include refid="selectByOperateLog"/>
		  )    
    </select>
</sqlMap>