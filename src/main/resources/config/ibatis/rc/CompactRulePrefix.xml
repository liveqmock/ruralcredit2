<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="COMPACTRULEPREFIX">
	<typeAlias alias="compactRulePrefixVO" type="com.creditease.rc.vo.CompactRulePrefixVO" />
	<typeAlias alias="compactRulePrefix" type="com.creditease.rc.domain.CompactRulePrefix" />
	<resultMap id="abatorgenerated_CompactRulePrefixResult" class="com.creditease.rc.domain.CompactRulePrefix">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		<result column="COMPACT_RULE_PREFIX_ID" property="compactRulePrefixId" jdbcType="DECIMAL" />
		<result column="PREFIX_MARK" property="prefixMark" jdbcType="VARCHAR" />
		<result column="TEAM_DEPARTMENT_ID" property="teamDepartmentId" jdbcType="VARCHAR" />
		<result column="TEAM_DEPARTMENT_NAME" property="teamDepartmentName" jdbcType="VARCHAR" />
		<result column="OPERATOR_NAME" property="operatorName" jdbcType="VARCHAR" />
		<result column="OPERATOR_ID" property="operatorId" jdbcType="VARCHAR" />
		<result column="OPERATE_DATE" property="operateDate" jdbcType="TIMESTAMP" />
		<result column="ON_OFF" property="onOff" jdbcType="VARCHAR" />
		<result column="PROVINCE" property="province" jdbcType="VARCHAR" />
		<result column="CITY" property="city" jdbcType="VARCHAR" />
		<result column="AREA" property="area" jdbcType="VARCHAR" />
	</resultMap>
	<resultMap id="compactRulePrefixResult_1" class="com.creditease.rc.vo.CompactRulePrefix_1">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		<result column="COMPACT_RULE_PREFIX_ID" property="compactRulePrefixId" jdbcType="DECIMAL" />
		<result column="PREFIX_MARK" property="prefixMark" jdbcType="VARCHAR" />
		<result column="TEAM_DEPARTMENT_ID" property="teamDepartmentId" jdbcType="VARCHAR" />
		<result column="TEAM_DEPARTMENT_NAME" property="teamDepartmentName" jdbcType="VARCHAR" />
		<result column="OPERATOR_NAME" property="operatorName" jdbcType="VARCHAR" />
		<result column="OPERATOR_ID" property="operatorId" jdbcType="VARCHAR" />
		<result column="OPERATE_DATE" property="operateDate" jdbcType="TIMESTAMP" />
		<result column="ON_OFF" property="onOff" jdbcType="VARCHAR" />
		<result column="PROVINCE" property="province" jdbcType="VARCHAR" />
		<result column="CITY" property="city" jdbcType="VARCHAR" />
		<result column="AREA" property="area" jdbcType="VARCHAR" />
		<result column="PROVINCE_ZH" property="province_zh" jdbcType="VARCHAR" />
		<result column="CITY_ZH" property="city_zh" jdbcType="VARCHAR" />
		<result column="AREA_ZH" property="area_zh" jdbcType="VARCHAR" />
		<result column="ON_OFF_ZH" property="onOff_zh" jdbcType="VARCHAR" />
	</resultMap>
	<select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_CompactRulePrefixResult" parameterClass="com.creditease.rc.domain.CompactRulePrefix">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		select COMPACT_RULE_PREFIX_ID, PREFIX_MARK, TEAM_DEPARTMENT_ID, TEAM_DEPARTMENT_NAME,
		OPERATOR_NAME, OPERATOR_ID, OPERATE_DATE, ON_OFF,PROVINCE,CITY,AREA
		from RL_COMPACT_RULE_PREFIX
		where COMPACT_RULE_PREFIX_ID = #compactRulePrefixId:DECIMAL#
	</select>
	<delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.creditease.rc.domain.CompactRulePrefix">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		delete from RL_COMPACT_RULE_PREFIX
		where COMPACT_RULE_PREFIX_ID = #compactRulePrefixId:DECIMAL#
	</delete>
	<insert id="abatorgenerated_insert" parameterClass="com.creditease.rc.domain.CompactRulePrefix">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		<selectKey resultClass="java.lang.Long" keyProperty="compactRulePrefixId" type="pre">
			select SEQ_MFC_COMMON.nextVal from dual
    </selectKey>
		insert into RL_COMPACT_RULE_PREFIX (COMPACT_RULE_PREFIX_ID,PREFIX_MARK, TEAM_DEPARTMENT_ID, TEAM_DEPARTMENT_NAME,
		OPERATOR_NAME, OPERATOR_ID, OPERATE_DATE, ON_OFF,PROVINCE,CITY,AREA)
		values (#compactRulePrefixId:DECIMAL#,#prefixMark:VARCHAR#, #teamDepartmentId:VARCHAR#, #teamDepartmentName:VARCHAR#,
		#operatorName:VARCHAR#, #operatorId:VARCHAR#, #operateDate:TIMESTAMP#, #onOff:VARCHAR#, #province:VARCHAR#, #city:VARCHAR#, #area:VARCHAR#)

	</insert>
	<update id="abatorgenerated_updateByPrimaryKey" parameterClass="com.creditease.rc.domain.CompactRulePrefix">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		update RL_COMPACT_RULE_PREFIX
		set PREFIX_MARK = #prefixMark:VARCHAR#,
		TEAM_DEPARTMENT_ID = #teamDepartmentId:VARCHAR#,
		TEAM_DEPARTMENT_NAME = #teamDepartmentName:VARCHAR#,
		OPERATOR_NAME = #operatorName:VARCHAR#,
		OPERATOR_ID = #operatorId:VARCHAR#,
		OPERATE_DATE = #operateDate:TIMESTAMP#,
		ON_OFF = #onOff:VARCHAR#,
		PROVINCE = #province:VARCHAR#,
		CITY = #city:VARCHAR#,
		ATEA = #area:VARCHAR#
		where COMPACT_RULE_PREFIX_ID = #compactRulePrefixId:DECIMAL#
	</update>
	<update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.creditease.rc.domain.CompactRulePrefix">
		<!-- WARNING - This element is automatically generated by Abator for iBATIS, do not modify. -->
		update RL_COMPACT_RULE_PREFIX
		<dynamic prepend="set">
			<isNotEmpty prepend="," property="prefixMark">
				PREFIX_MARK = #prefixMark:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="teamDepartmentId">
				TEAM_DEPARTMENT_ID = #teamDepartmentId:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="teamDepartmentName">
				TEAM_DEPARTMENT_NAME = #teamDepartmentName:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="operatorName">
				OPERATOR_NAME = #operatorName:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="operatorId">
				OPERATOR_ID = #operatorId:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="operateDate">
				OPERATE_DATE = #operateDate:TIMESTAMP#
      </isNotEmpty>
			<isNotEmpty prepend="," property="onOff">
				ON_OFF = #onOff:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="province">
				PROVINCE = #province:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="city">
				CITY = #city:VARCHAR#
      </isNotEmpty>
			<isNotEmpty prepend="," property="area">
				AREA = #area:VARCHAR#
      </isNotEmpty>
		</dynamic>
		where COMPACT_RULE_PREFIX_ID = #compactRulePrefixId:DECIMAL#
	</update>
	<sql id="selectBySelectiveSql">
		select COMPACT_RULE_PREFIX_ID, PREFIX_MARK, TEAM_DEPARTMENT_ID, TEAM_DEPARTMENT_NAME,
		OPERATOR_NAME, OPERATOR_ID, OPERATE_DATE, ON_OFF,PROVINCE,CITY,AREA
		from RL_COMPACT_RULE_PREFIX
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="compactRulePrefixId">
				COMPACT_RULE_PREFIX_ID = #compactRulePrefixId:DECIMAL#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="prefixMark">
				PREFIX_MARK = #prefixMark:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="teamDepartmentId">
				TEAM_DEPARTMENT_ID = #teamDepartmentId:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="teamDepartmentName">
				TEAM_DEPARTMENT_NAME = #teamDepartmentName:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="operatorName">
				OPERATOR_NAME = #operatorName:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="operatorId">
				OPERATOR_ID = #operatorId:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="operateDate">
				OPERATE_DATE = #operateDate:TIMESTAMP#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="onOff">
				ON_OFF = #onOff:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="province">
				PROVINCE = #province:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="city">
				CITY = #city:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="area">
				AREA = #area:VARCHAR#
	      </isNotEmpty>
		</dynamic>
	</sql>
	<!-- 包含省市区和状态的查询 -->
	<sql id="selectBySelectiveSql_1">
		select COMPACT_RULE_PREFIX_ID, PREFIX_MARK, TEAM_DEPARTMENT_ID, TEAM_DEPARTMENT_NAME,
		OPERATOR_NAME, OPERATOR_ID, OPERATE_DATE, ON_OFF,PROVINCE,CITY,AREA,
		(select CITY_NAME from MFC_NATIONAL_STANDARD where CITY_CODE=PROVINCE) as PROVINCE_ZH,
		(select CITY_NAME from MFC_NATIONAL_STANDARD where CITY_CODE=CITY) as CITY_ZH,
		(select CITY_NAME from MFC_NATIONAL_STANDARD where CITY_CODE=AREA) as AREA_ZH,
		(select CODE_VALUE from MFC_CODETABLE WHERE SECTION='onOff' AND CODE_KEY=ON_OFF) as ON_OFF_ZH
		from RL_COMPACT_RULE_PREFIX
		<dynamic prepend="where">
			<isNotEmpty prepend="and" property="compactRulePrefixId">
				COMPACT_RULE_PREFIX_ID = #compactRulePrefixId:DECIMAL#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="prefixMark">
				PREFIX_MARK = #prefixMark:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="teamDepartmentId">
				TEAM_DEPARTMENT_ID = #teamDepartmentId:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="teamDepartmentName">
				TEAM_DEPARTMENT_NAME = #teamDepartmentName:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="operatorName">
				OPERATOR_NAME = #operatorName:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="operatorId">
				OPERATOR_ID = #operatorId:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="operateDate">
				OPERATE_DATE = #operateDate:TIMESTAMP#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="onOff">
				ON_OFF = #onOff:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="province">
				PROVINCE = #province:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="city">
				CITY = #city:VARCHAR#
	      </isNotEmpty>
			<isNotEmpty prepend="and" property="area">
				AREA = #area:VARCHAR#
	      </isNotEmpty>
		</dynamic>
	</sql>
	<!-- -->
	<select id="selectBySelective" parameterClass="compactRulePrefix" resultMap="abatorgenerated_CompactRulePrefixResult">
		<include refid="selectBySelectiveSql" />
	</select>
	<!-- 分页查询合同规则前缀 -->
	<select id="selectListByPage" parameterClass="compactRulePrefixVO" resultMap="compactRulePrefixResult_1">
		<include refid="selectBySelectiveSql_1" />
		<isNotEmpty property="sort" prepend="ORDER BY">
			<isEqual property="sort" compareValue="teamDepartmentName">
				TEAM_DEPARTMENT_NAME $order$
				</isEqual>
			<isEqual property="sort" compareValue="prefixMark">
				PREFIX_MARK $order$
				</isEqual>
			<isEqual property="sort" compareValue="province_zh">
				PROVINCE_ZH $order$
				</isEqual>
			<isEqual property="sort" compareValue="city_zh">
				CITY_ZH $order$
				</isEqual>
			<isEqual property="sort" compareValue="area_zh">
				AREA_ZH $order$
				</isEqual>
			<isEqual property="sort" compareValue="onOff_zh">
				ON_OFF_ZH $order$
				</isEqual>
			<isEqual property="sort" compareValue="operatorName">
				OPERATOR_NAME $order$
				</isEqual>
			<isEqual property="sort" compareValue="operateDate">
				OPERATE_DATE $order$
				</isEqual>
		</isNotEmpty>
		<isEmpty property="sort" prepend="ORDER BY">
			OPERATE_DATE $order$ 
			</isEmpty>
	</select>
	<select id="selectCountByPage" parameterClass="compactRulePrefixVO" resultClass="int">
		select count(*) from
		(
		<include refid="selectBySelectiveSql_1" />
		)
	</select>

	<sql id="select-prefix">
		select c.COMPACT_RULE_PREFIX_ID, c.PREFIX_MARK, c.TEAM_DEPARTMENT_ID, c.TEAM_DEPARTMENT_NAME,
		c.OPERATOR_NAME, c.OPERATOR_ID, c.OPERATE_DATE, c.ON_OFF,c.PROVINCE,c.CITY,c.AREA
		from RL_COMPACT_RULE_PREFIX c
  </sql>


	<!--“区/县” 分组 -->
	<select id="selectGroupByArea" resultClass="java.lang.String">
		select c.area
		from rl_compact_rule_prefix c
		where c.on_off = 'Y' and c.area is not null
		group by c.area 
  
  </select>

	<!--城市 分组 -->
	<select id="selectGroupByCity" resultClass="java.lang.String">
	select c.city
	from rl_compact_rule_prefix c
	where c.on_off = 'Y' and c.city is not null
	group by c.city   
  
  </select>

	<!-- 查询区县下营业部 按照咨询池的已受理状态的数量进行排序 -->
	<select id="selectCompactRulePrefixByArea" resultMap="abatorgenerated_CompactRulePrefixResult" parameterClass="java.lang.String">
		<include refid="select-prefix" />
		left join
		( select p.teamdepartment_id, count(p.consult_pool_id) count_consult_pool_id
		from mfc_customer_consult_pool p
		where 1 = 1
		and p.market_consult_state = '3'
		and p.teamdepartment_id is not null
		group by p.teamdepartment_id
		) new_pool on new_pool.teamdepartment_id=c.team_department_id
		where 1=1
		and c.on_off = 'Y'
		and c.area is not null
		and c.area=#area:VARCHAR#
		order by nvl( new_pool.count_consult_pool_id,0)

	</select>


	<!-- 查询城市下营业部 按照咨询池的已受理状态的数量进行排序 -->
	<select id="selectCompactRulePrefixByCity" resultMap="abatorgenerated_CompactRulePrefixResult" parameterClass="java.lang.String">
		<include refid="select-prefix" />
		left join
		( select p.teamdepartment_id, count(p.consult_pool_id) count_consult_pool_id
		from mfc_customer_consult_pool p
		where 1 = 1
		and p.market_consult_state = '3'
		and p.teamdepartment_id is not null
		group by p.teamdepartment_id
		) new_pool on new_pool.teamdepartment_id=c.team_department_id
		where 1=1
		and c.on_off = 'Y'
		and c.city is not null
		and c.city=#city:VARCHAR#
		order by nvl( new_pool.count_consult_pool_id,0)
	</select>

</sqlMap>