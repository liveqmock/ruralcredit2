<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="RL_BORROW_MATCHING" >
  <resultMap id="abatorgenerated_BorrowMatchingResult" class="com.creditease.rc.domain.BorrowMatching" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    <result column="BORROWMATCHINGID" property="borrowmatchingid" jdbcType="DECIMAL" />
    <result column="CREDITAPPLICATION_ID" property="creditapplicationId" jdbcType="DECIMAL" />
    <result column="MATCHID" property="matchid" jdbcType="VARCHAR" />
    <result column="SUBMITTIME" property="submittime" jdbcType="TIMESTAMP" />
    <result column="STATUS" property="status" jdbcType="VARCHAR" />
    <result column="ERRORMSG" property="errormsg" jdbcType="VARCHAR" />
    <result column="CREATION_TIME" property="creationTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <!-- 根据信贷申请id查询撮合id -->
  <select id="selectMatchidByCreditapplicationId" parameterClass="long" resultClass="java.util.HashMap">
  	select rbm.matchid,rbm.* from rl_borrow_matching  rbm where rbm.creditapplication_id=#creditapplicationId# and 
rbm.creation_time = (select max(t.creation_time) from rl_borrow_matching t where t.creditapplication_id=#creditapplicationId#)
  </select>
  <select id="abatorgenerated_selectByPrimaryKey" resultMap="abatorgenerated_BorrowMatchingResult" parameterClass="com.creditease.rc.domain.BorrowMatching" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    select BORROWMATCHINGID, CREDITAPPLICATION_ID, MATCHID, SUBMITTIME, STATUS,
      ERRORMSG,CREATION_TIME
    from RL_BORROW_MATCHING
    where BORROWMATCHINGID = #borrowmatchingid:DECIMAL#
  </select>
  <delete id="abatorgenerated_deleteByPrimaryKey" parameterClass="com.creditease.rc.domain.BorrowMatching" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    delete from RL_BORROW_MATCHING
    where BORROWMATCHINGID = #borrowmatchingid:DECIMAL#
  </delete>
  <insert id="abatorgenerated_insert" parameterClass="com.creditease.rc.domain.BorrowMatching" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    <selectKey resultClass="java.lang.Long" keyProperty="borrowmatchingid" >
      select SEQ_BASIC_INFO.NEXTVAL  from dual
    </selectKey>
    insert into RL_BORROW_MATCHING (CREDITAPPLICATION_ID, MATCHID, SUBMITTIME,
      STATUS, ERRORMSG,BORROWMATCHINGID,CREATION_TIME)
    values (#creditapplicationId:DECIMAL#, #matchid:VARCHAR#,
      #submittime:TIMESTAMP#, #status:VARCHAR#, #errormsg:VARCHAR#,#borrowmatchingid:DECIMAL#,#creationTime:TIMESTAMP#)
    
  </insert>
  <!-- 根据撮合信贷申请id查询这个撮合是否成功 -->
  <select id="selectStatusbyCreditapplicationId"  parameterClass="long" resultClass="string">
  	select rbm.status from rl_borrow_matching rbm where  rbm.creation_time = (select max(bm.creation_time) from rl_borrow_matching bm where bm.creditapplication_id=#creditapplicationId#) 
  </select>
  <update id="abatorgenerated_updateByPrimaryKey" parameterClass="com.creditease.rc.domain.BorrowMatching" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_BORROW_MATCHING
    set CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#,
      MATCHID = #matchid:VARCHAR#,
      SUBMITTIME = #submittime:TIMESTAMP#,
      STATUS = #status:VARCHAR#,
      ERRORMSG = #errormsg:VARCHAR#,
      CREATION_TIME = #creationTime:TIMESTAMP#
    where BORROWMATCHINGID = #borrowmatchingid:DECIMAL#
  </update>
  
  <!-- 根据申请id更新撮合成功状态 -->
  <update id="updateByCaId" parameterClass="com.creditease.rc.domain.BorrowMatching" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_BORROW_MATCHING
    <dynamic prepend="set" >
    	<isNotNull prepend="," property="borrowmatchingid" >
        BORROWMATCHINGID = #borrowmatchingid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="creditapplicationId" >
        CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="matchid" >
        MATCHID = #matchid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="submittime" >
        SUBMITTIME = #submittime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS = #status:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="errormsg" >
        ERRORMSG = #errormsg:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="creationTime" >
        CREATION_TIME = #creationTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where CREDITAPPLICATION_ID = #creditapplicationId# and 
    SUBMITTIME = (select max(rm.submittime) from rl_borrow_matching rm where rm.creditapplication_id=#creditapplicationId#)
  </update>
  
  
  
  
  
  
  <update id="abatorgenerated_updateByPrimaryKeySelective" parameterClass="com.creditease.rc.domain.BorrowMatching" >
    <!--
      WARNING - This element is automatically generated by Abator for iBATIS, do not modify.
    -->
    update RL_BORROW_MATCHING
    <dynamic prepend="set" >
    	<isNotNull prepend="," property="borrowmatchingid" >
        BORROWMATCHINGID = #borrowmatchingid:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="creditapplicationId" >
        CREDITAPPLICATION_ID = #creditapplicationId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="matchid" >
        MATCHID = #matchid:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="submittime" >
        SUBMITTIME = #submittime:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="status" >
        STATUS = #status:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="errormsg" >
        ERRORMSG = #errormsg:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="creationTime" >
        CREATION_TIME = #creationTime:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where BORROWMATCHINGID = #borrowmatchingid:DECIMAL#
  </update>
</sqlMap>